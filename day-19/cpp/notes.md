Terrifying. I'm guessing using a parser-generator language would have made this day a lot easier. I spent *hours* just on parsing the input and translating it into logic, having to rework the entire approach at least twice.
Part 2 was conceptually simple and I did not initially understand why my solution for part 1 wasn't still working. After a while I realized that it really just meant that rules could now produce several partial matches. The actual implementation changes were then not too large.
